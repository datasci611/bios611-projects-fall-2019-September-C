---
title: "BIOS 661 Project 1"
author: "Xinran Chu"
date: "10/07/2019"
output:
  pdf_document: default
  html_document: default
---

## Background 

The data was provided by UMD (Urban Ministry of Durham). Established in 1983, Urban Ministries of Durham works holistically to end homelessness and meet the emergency needs of very poor and hungry neighbors through its programs and in partnership with other nonprofits. UMD offers food, shelter and a future to about 6,000 men, women and children annually. 

The data consists of 79838 observations and 13 variables (5 categorical variables and 8 numerical variables) from 1931 to 2019. However, since UMD was not established till 1983, I removed the observations with Date prior to 1983. For this project, I am using the variables 'Date' and 'Food Pounds'.  

## Research Question  

My focus of this project is to look at the amount of food provided by UMD along with its trend in three seperate time periods: before 2000, between 2000 and 2009, and after 2009.  


```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(ggplot2)
library(hexbin)
```   

```{r echo=F,  message=FALSE, include=FALSE}
dat = read_tsv("https://raw.githubusercontent.com/biodatascience/datasci611/gh-pages/data/project1_2019/UMD_Services_Provided_20190719.tsv")

dat = dat[ , -c(2,3,4,5,8,9,10,11,12,13,14,15,16,17,18)]

dat$Date =  as.Date(dat$Date,'%m/%d/%Y')

dat.food = dat[ ,-2]

dat.food.before.2000 = dat.food %>%
  filter(substr(dat.food$Date, 1, 4) < 2000 & substr(dat.food$Date, 1, 4) > 1982 & dat.food$`Food Pounds` > 0) 

length(which(!is.na(dat.food.before.2000$`Food Pounds`))) 
# which(!is.na(dat.food.before.2000$`Food Pounds`))

dat.food.2000to2009 = dat.food %>%
  filter(substr(dat.food$Date, 1, 4) < 2010 & substr(dat.food$Date, 1, 4) >= 2000 &   dat.food$`Food Pounds` > 0)
#View(dat.food.2000to2009)

length(which(!is.na(dat.food.2000to2009$`Food Pounds`))) 
#which(!is.na(dat.food.2000to2009$`Food Pounds`))

dat.food.after2009 = dat.food %>%
  filter(substr(dat.food$Date, 1, 4) >= 2010 &   dat.food$`Food Pounds` > 0) 
#View(dat.food.after2009)

length(which(!is.na(dat.food.after2009$`Food Pounds`))) 
#which(!is.na(dat.food.after2009$`Food Pounds`))
```   

## Remove outliers  

### First check the boxplots to identify outliers  

```{r echo = F}
boxplot(dat.food.before.2000$`Food Pounds`, main = "Before 2000")
```  

```{r echo = F}
boxplot(dat.food.2000to2009$`Food Pounds`, main = "Between 2000 and 2009")
```   

```{r echo = F}
boxplot(dat.food.after2009$`Food Pounds`, main = "After 2009")
```   

```{r echo=F, include = F}
# identify outliers using boxplot function and assign the outlier values into a vector
outliers1 = boxplot(dat.food.before.2000$`Food Pounds`, plot=FALSE)$out 

outliers2 = boxplot(dat.food.2000to2009$`Food Pounds`, plot=FALSE)$out 

outliers3 = boxplot(dat.food.after2009$`Food Pounds`, plot=FALSE)$out 

# Check the results

print(outliers1)
print(outliers2)
print(outliers3)

# Removing the outliers
# First find in which rows the outliers are
dat.food.before.2000[which(dat.food.before.2000$`Food Pounds` %in% outliers1),]
dat.food.2000to2009[which(dat.food.2000to2009$`Food Pounds` %in% outliers2),]
dat.food.after2009[which(dat.food.after2009$`Food Pounds` %in% outliers3),]

# Now you can remove the rows containing the outliers, one possible option is:
dat.food.before.2000 = dat.food.before.2000[-which(dat.food.before.2000$`Food Pounds` %in% outliers1),]
dat.food.2000to2009 = dat.food.2000to2009[-which(dat.food.2000to2009$`Food Pounds` %in% outliers2),]
dat.food.after2009 = dat.food.after2009[-which(dat.food.after2009$`Food Pounds` %in% outliers3),]
```  

### After removing outliers, if we check now with boxplots, we notice that those pesky outliers are gone  

```{r echo=F}
# If we check now with boxplots, we notice that those pesky outliers are gone
boxplot(dat.food.before.2000$`Food Pounds`, main = "Before 2000")
```   

```{r echo=F}
boxplot(dat.food.2000to2009$`Food Pounds`, main = "Between 2000 and 2009")
```  

```{r echo=F}
boxplot(dat.food.after2009$`Food Pounds`, main = "After 2009")
```   

## Summary of the amount of food in pounds distributed in each period (after removing outliers).    

```{r echo=F}
summary(dat.food.before.2000$`Food Pounds`)
summary(dat.food.2000to2009$`Food Pounds`)
summary(dat.food.after2009$`Food Pounds`)

# total lbs of food provided inn each period
sum(dat.food.before.2000$`Food Pounds`) 
sum(dat.food.2000to2009$`Food Pounds`) 
sum(dat.food.after2009$`Food Pounds`) 
```  

### A total of 145 pounds of food were provided before 2000  
### A total of 154,428 pounds of food were provided between 2000 and 2009  
### A total of 930,893 pounds of food were provided after 2009  

## Plot the trend for each period  

```{r echo=F}
ggplot(dat.food.before.2000,aes(x=dat.food.before.2000$Date, y=dat.food.before.2000$`Food Pounds`)) +
  geom_point()+ 
  geom_smooth() + 
  ggtitle("Amount of Food Distributed over Time Before 2000 (lbs)") +
  xlab("Date") + ylab("Amount of Food Distributed (lbs)")
```  

### Before 2000, the amount of food distributed in pounds by UMD first went up till 1991, then went down and reached its minimum in between 1994 and 1995, and then started going up again.  

```{r echo=F}
ggplot(dat.food.2000to2009,aes(x=dat.food.2000to2009$Date, y=dat.food.2000to2009$`Food Pounds`)) +
  geom_point() + 
  geom_smooth() + 
  ggtitle("Amount of Food Distributed over Time between 2000 and 2009 (lbs)") +
  xlab("Date") + ylab("Amount of Food Distributed (lbs)")
```  

### Between 2000 and 2009, the amount of food distributed first went down, reaching its minimum in about 2005, and was faily steady afterwards. 

```{r echo=F}
ggplot(dat.food.after2009,aes(x=dat.food.after2009$Date, y=dat.food.after2009$`Food Pounds`)) +
  geom_point() + 
  geom_smooth() + 
  ggtitle("Amount of Food Distributed over Time after 2009 (lbs)") +
  xlab("Date") + ylab("Amount of Food Distributed (lbs)")
```   

### After 2009, the amount of food distributed showed an overall increasing trend, with slight fluctuations.   


### From the numerical summaries and the plots, we observe that the total amount of food provided by UMD has been increasing in large magnitude. However, within each time period, there were fluctuations in the amount of food distributed by UMD. Perhaps in the future, we can conduct further analysis to identify the causes of these fluctuations.     
